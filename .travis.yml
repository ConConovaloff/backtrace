language: php

matrix:
  include:
    - php: 5.4
      env: CHECKS=yes
    - php: 5.5
    - php: 5.6
    - php: 7.0
    - php: hhvm

sudo: false

before_install:
  - composer self-update
  - phpenv config-rm xdebug.ini
  - alias phpX='php -dzend_extension=xdebug.so'

install:
  - composer install
  - if [ "$CHECKS" = "yes" ]; then composer require satooshi/php-coveralls --dev; fi;
  - if [ "$CHECKS" = "yes" ]; then composer require squizlabs/php_codesniffer="~2.3" --dev; fi;

script:
  - if [ ! "$CHECKS" = "yes" ]; then phpunit; fi;
  - if [ "$CHECKS" = "yes" ]; then mkdir -p build/logs; fi;
  - if [ "$CHECKS" = "yes" ]; then phpX $(which phpunit) --coverage-clover build/logs/clover.xml; fi;
  - if [ "$CHECKS" = "yes" ]; then php vendor/bin/phpcs --standard=PSR2 --encoding=utf-8 --ignore=vendor .; fi;

after_success:
  - if [ "$CHECKS" = "yes" ]; then php vendor/bin/coveralls -c .coveralls.yml; fi;

notifications:
  email:
    on_success: change
    on_failure: always
